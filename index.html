<!DOCTYPE html>
<html>
<head>
    <title>EditMode</title>
    <style>
        /* Base styles */
        :root {
            --primary-color: #2b579a;
            --toolbar-bg: #f3f2f1;
            --border-color: #e1dfdd;
            --hover-bg: #edebe9;
            --active-bg: #e1dfdd;
            --text-color: #323130;
            --button-text: #616161;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --editor-bg: white;
            --border-radius-sm: 6px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --transition-speed: 0.2s;
        }

        :root[data-theme="dark"] {
            --primary-color: #4b9cff;
            --toolbar-bg: #1f1f1f;
            --border-color: #404040;
            --hover-bg: #2d2d2d;
            --active-bg: #404040;
            --text-color: #ffffff;
            --button-text: #d0d0d0;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --editor-bg: #2d2d2d;
        }

        :root[data-theme="hacker"] {
            --primary-color: #00ff00;
            --toolbar-bg: #0a0a0a;
            --border-color: #00ff00;
            --hover-bg: #1a1a1a;
            --active-bg: #2a2a2a;
            --text-color: #00ff00;
            --button-text: #00cc00;
            --shadow-color: rgba(0, 255, 0, 0.2);
            --editor-bg: #000000;
        }

        :root[data-theme="kawaii"] {
            --primary-color: #ff8dc7;
            --toolbar-bg: #fff0f7;
            --border-color: #ffcce6;
            --hover-bg: #ffe6f2;
            --active-bg: #ffd9ec;
            --text-color: #8f5c7c;
            --button-text: #b771a2;
            --shadow-color: rgba(255, 141, 199, 0.2);
            --editor-bg: #ffffff;
        }

        /* Shared styles for all themes */
        .toolbar-button,
        .menu-item,
        .view-mode-switch {
            border-radius: var(--border-radius-md);
            transition: all var(--transition-speed) ease;
        }

        .spreadsheet-cell:hover {
            background: 0 2px 8px var(--shadow-color);
        }

        .dropdown-menu { 
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 24px var(--shadow-color);
            border: 2px solid var(--border-color);
            padding: 8px; 
        }

        .toolbar-separator {
            border-radius: 4px;
        }

        .view-mode-switch::before {
            border-radius: var(--border-radius-md);
            box-shadow: 0 2px 6px var(--shadow-color);
        }

        /* Theme-specific styles */
        :root[data-theme="dark"] .spreadsheet-cell:hover {
            background-color: var(--hover-bg);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        :root[data-theme="hacker"] .spreadsheet-cell,
        :root[data-theme="hacker"] .editor-content[contenteditable="true"] {
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        :root[data-theme="hacker"] .spreadsheet-cell:hover {
            background-color: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 12px rgba(0, 255, 0, 0.3);
        }

        :root[data-theme="hacker"] .column-header,
        :root[data-theme="hacker"] .row-header,
        :root[data-theme="hacker"] .corner-cell {
            background-color: #0a0a0a;
            border-color: #00ff00;
            color: #00ff00;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.2);
        }

        :root[data-theme="hacker"] .toolbar-separator {
            background: linear-gradient(to bottom, #003300, #00ff00);
        }

        :root[data-theme="hacker"] #toolbar,

        :root[data-theme="kawaii"] .spreadsheet-cell:hover {
            background-color: var(--hover-bg);
        }

        :root[data-theme="kawaii"] .toolbar-separator {
            background: linear-gradient(to bottom, var(--border-color), var(--primary-color));
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--text-color);
            background-color: var(--toolbar-bg);
        }

        /* Layout components */
        #file-bar {
            height: 32px;
            background-color: var(--toolbar-bg);
            display: flex;
            align-items: stretch;
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 12px;
            gap: 2px;
        }

        #toolbar {
            width: fit-content;
            margin: 20px auto 0;
            padding: 8px 16px;
            background-color: var(--editor-bg);
            border: 1px solid var(--border-color);
            display: flex;
            border-radius: 30px;
            gap: 8px;
            align-items: center;
            position: sticky;
            top: 40px;
            z-index: 99;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        /* Toolbar components */
        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 0 8px;
        }

        .toolbar-button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            color: var(--button-text);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
            min-width: 32px;
            justify-content: center;
            position: relative;
        }

        .toolbar-button:active {
            background: var(--active-bg);
        }

        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: var(--border-color);
            margin: 0 8px;
        }

        /* Dropdown and menu components */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--editor-bg);
            min-width: 200px;
            box-shadow: 0 4px 12px var(--shadow-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            display: none;
            z-index: 1000;
            margin-top: 4px;
            padding: 4px 0;
        }

        .dropdown-menu.show {
            display: block;
        }

        .menu-item {
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            font-size: 13px;
            transition: all 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .menu-item:hover {
            color: var(--primary-color);
        }

        .menu-item:active {
            background: var(--active-bg);
        }

        .menu-separator {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }

        /* File tab specific styles */
        .file-tab {
            padding: 0 16px;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: var(--text-color);
            font-size: 13px;
            position: relative;
            height: 100%;
            transition: all var(--transition-speed) ease;
            border-radius: 6px 6px 0 0;
            margin-top: 4px;
        }

        .file-tab:hover {
            background-color: var(--hover-bg);
        }

        .file-tab:active {
            background-color: var(--active-bg);
        }

        .file-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: all var(--transition-speed) ease;
            transform: translateX(-50%);
        }

        .file-tab:hover::after {
            width: 80%;
        }

        .file-tab span {
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        /* Remove the existing border-right from .file-tab */
        .file-tab + .file-tab {
            margin-left: 2px;
        }

        /* Select button styles */
        select.toolbar-button {
            padding: 6px 28px 6px 12px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23616161%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 8px;
            color: var(--button-text);
        }

        :root[data-theme="dark"] select.toolbar-button {
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23d0d0d0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }

        select.toolbar-button:hover {
            background-color: var(--hover-bg);
        }

        /* Editor styles */
        #editor {
            padding: 20px;
            height: calc(100vh - 120px);
            overflow-y: auto;
            background-color: var(--toolbar-bg);
        }

        #editor:has(.spreadsheet-view) {
            overflow: hidden;
        }

        .editor-content {
            max-width: 816px;
            margin: 0 auto;
            background: var(--editor-bg);
            padding: 72px 72px;
            min-height: 1056px;
            box-shadow: 0 2px 6px var(--shadow-color);
            outline: none;
            font-size: 11pt;
            line-height: 1.5;
            color: var(--text-color);
        }

        .editor-content.spreadsheet-view {
            max-width: none;
            padding: 0;
            min-height: auto;
        }

        /* Icon styles */
        .toolbar-button[onclick*="bold"]::before {
            content: "B";
            font-weight: bold;
        }

        .toolbar-button[onclick*="italic"]::before {
            content: "I";
            font-style: italic;
        }

        .toolbar-button[onclick*="underline"]::before {
            content: "U";
            text-decoration: underline;
        }

        .toolbar-button[onclick*="justify"]::before {
            content: "≡";
            font-size: 16px;
        }

        /* Add these styles */
        .view-mode-switch {
            display: flex;
            align-items: center;
            gap: 0;
            padding: 2px;
            border-radius: 4px;
            background: var(--hover-bg);
            cursor: pointer;
            user-select: none;
            position: relative;
            width: 100px;
            height: 24px;
        }

        .view-mode-switch::before {
            content: "";
            position: absolute;
            width: 50px;
            height: 20px;
            background: var(--editor-bg);
            border-radius: 2px;
            left: 2px;
            transition: transform 0.2s ease;
            transform: translateX(var(--slide-pos, 0));
            border: 1px solid var(--border-color);
        }

        .view-mode-switch.spreadsheet-mode::before {
            --slide-pos: 46px;
        }

        .view-mode-switch span {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: var(--button-text);
            position: relative;
            z-index: 1;
            text-transform: lowercase;
            font-weight: 500;
        }

        .view-mode-switch.spreadsheet-mode .spreadsheet-label,
        .view-mode-switch:not(.spreadsheet-mode) .doc-label {
            color: var(--primary-color);
        }

        /* Update toolbar separator margin */
        .toolbar-separator {
            margin: 0 8px;
        }

        /* Spreadsheet styles */
        .spreadsheet-wrapper {
            overflow: auto;
            width: 100%;
            height: calc(100vh - 180px);
            padding-bottom: 0;
            position: relative;
        }

        .spreadsheet-container {
            transform-origin: 0 0;
            min-width: fit-content;
            display: inline-block;
        }

        .spreadsheet-table {
            border-collapse: collapse;
            width: auto;
            min-width: max-content;
            font-size: 11pt;
            font-family: Calibri, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--editor-bg);
        }

        .spreadsheet-cell {
            border: 1px solid var(--border-color);
            padding: 2px 4px;
            min-width: 80px;
            height: 20px;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: var(--editor-bg);
            position: relative;
            vertical-align: middle;
        }

        .spreadsheet-cell:hover {
            white-space: normal;
            word-break: break-word;
        }

        .column-header {
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            padding: 2px 4px;
            min-width: 80px;
            height: 20px;
            box-sizing: border-box;
            text-align: center;
            font-weight: normal;
            position: sticky;
            top: 0;
            z-index: 1;
            font-size: 11pt;
        }

        .row-header {
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            padding: 2px 4px;
            min-width: 40px;
            width: 40px;
            height: 20px;
            box-sizing: border-box;
            text-align: center;
            font-weight: normal;
            position: sticky;
            left: 0;
            z-index: 1;
            font-size: 11pt;
        }

        .corner-cell {
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            min-width: 40px;
            width: 40px;
            height: 20px;
            box-sizing: border-box;
            position: sticky;
            top: 0;
            left: 0;
            z-index: 2;
            padding: 2px 4px;
            text-align: center;
            font-weight: normal;
            font-size: 11pt;
            vertical-align: middle;
        }

        .editor-content.spreadsheet-view {
            padding: 0;
            max-width: none;
        }

        /* Add kawaii theme specific styles */
        :root[data-theme="kawaii"] .toolbar-button,
        :root[data-theme="kawaii"] .menu-item,
        :root[data-theme="kawaii"] .file-tab,

        :root[data-theme="kawaii"] .toolbar-button:hover,
        :root[data-theme="kawaii"] .menu-item:hover {
            transform: scale(1.05);
        }

        :root[data-theme="kawaii"] .spreadsheet-cell,
        :root[data-theme="kawaii"] .editor-content[contenteditable="true"] {
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        :root[data-theme="kawaii"] .spreadsheet-cell:hover {
            background-color: var(--hover-bg);
            transform: scale(1.02);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        :root[data-theme="kawaii"] .column-header,
        :root[data-theme="kawaii"] .row-header,
        :root[data-theme="kawaii"] .corner-cell {
            background-color: var(--toolbar-bg);
            border-color: var(--border-color);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        :root[data-theme="kawaii"] .toolbar-separator {
            background: linear-gradient(to bottom, var(--border-color), var(--primary-color));
            border-radius: 4px;
            width: 2px;
        }

        :root[data-theme="kawaii"] .view-mode-switch::before {
            border-radius: 10px;
            box-shadow: 0 2px 6px var(--shadow-color);
        }

        :root[data-theme="kawaii"] .editor-content {
            border-radius: 20px;
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        /* Theme-specific corner cell styles */
        :root[data-theme="dark"] .corner-cell {
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
        }

        :root[data-theme="hacker"] .corner-cell {
            background-color: #0a0a0a;
            border: 1px solid #00ff00;
            color: #00ff00;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        :root[data-theme="kawaii"] .corner-cell {
            background-color: var(--toolbar-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-weight: bold;
            border-radius: 8px;
        }

        /* Add this to the style section */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: var(--editor-bg);
            padding: 24px;
            border-radius: var(--border-radius-lg);
            box-shadow: 0 4px 12px var(--shadow-color);
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        .loading-text {
            color: var(--text-color);
            font-size: 14px;
            margin: 0;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Update zoom control styles */
        .zoom-controls {
            display: none;
        }
        
        .spreadsheet-mode .zoom-controls {
            display: flex;
            align-items: center;
            gap: 4px;  /* Add consistent spacing */
        }
        
        .zoom-slider {
            width: 80px;  /* Reduced from 100px */
            margin: 0;    /* Remove margins, use gap instead */
            cursor: pointer;
        }
        
        .zoom-level {
            min-width: 42px;  /* Reduced from 48px */
            text-align: right;
            color: var(--button-text);
            font-size: 13px;
            padding-right: 8px;  /* Add padding instead of extra width */
        }
        
        /* Make zoom buttons more compact */
        .zoom-controls .toolbar-button {
            padding: 4px 8px;  /* Reduced padding */
            min-width: 24px;   /* Smaller minimum width */
            font-weight: bold; /* Make +/- symbols bold */
        }
        
        /* Style the range input for different browsers */
        .zoom-slider {
            -webkit-appearance: none;
            height: 3px;  /* Slightly thinner bar */
            border-radius: 2px;
            background: var(--border-color);
            outline: none;
        }
        
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px;  /* Slightly smaller thumb */
            height: 10px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .zoom-slider::-moz-range-thumb {
            width: 10px;  /* Slightly smaller thumb */
            height: 10px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        /* Update the toolbar separator for zoom controls */
        .zoom-controls.toolbar-separator {
            margin: 0 4px;  /* Reduced margin */
            height: 20px;   /* Match the height of other items */
        }

        /* Color picker styles */
        .color-picker-button {
            width: 28px;
            height: 28px;
            padding: 3px !important;
            position: relative;
            border-radius: 4px;
            background: transparent;
        }

        .color-picker-wrapper {
            position: relative;
            display: inline-block;
        }

        .color-preview {
            width: 22px;
            height: 22px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-preview:hover {
            transform: scale(1.05);
        }

        .color-picker-popup {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 8px;
            background: var(--editor-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            display: none;
            z-index: 1000;
            width: 220px;
        }

        .color-picker-popup.show {
            display: block;
        }

        .preset-colors {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .preset-color {
            width: 22px;
            height: 22px;
            border-radius: 3px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .preset-color:hover {
            transform: scale(1.1);
        }

        .color-picker-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }

        .custom-color {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .custom-color input[type="color"] {
            width: 100%;
            height: 24px;
            padding: 0;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            background: transparent;
        }

        .custom-color input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .custom-color input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 2px;
        }

        .custom-color input[type="color"]::-moz-color-swatch {
            border: none;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">Generating PDF...</p>
        </div>
    </div>
    <div id="file-bar">
        <div class="file-tab" onclick="toggleFileMenu()">
            <span>File</span>
            <div id="fileMenu" class="dropdown-menu">
                <button class="menu-item" onclick="newDocument()">
                    <span>New (⌘N)</span>
                </button>
                <button class="menu-item" onclick="openFile()">
                    <span>Open... (⌘O)</span>
                </button>
                <button class="menu-item" onclick="saveDocument('docx')">
                    <span>Save (⌘S)</span>
                </button>
                <div class="menu-separator"></div>
                <!-- <button class="menu-item" onclick="saveDocument('docx')">
                    <span>Save as DOCX</span>
                </button>
                <button class="menu-item" onclick="saveDocument('xlsx')">
                    <span>Save as XLSX</span>
                </button> -->
                <button class="menu-item" onclick="saveDocument('pdf')">
                    <span>Export as PDF</span>
                </button>
                <button class="menu-item" onclick="saveDocument('html')">
                    <span>Export as HTML</span>
                </button>
            </div>
        </div>
        <div class="file-tab" onclick="toggleStyleMenu()">
            <span>Style</span>
            <div id="styleMenu" class="dropdown-menu">
                <button class="menu-item" onclick="setTheme('light')">
                    <span>Light </span>
                </button>
                <button class="menu-item" onclick="setTheme('dark')">
                    <span>Dark </span>
                </button>
                <button class="menu-item" onclick="setTheme('hacker')">
                    <span>Hacker </span>
                </button>
                <button class="menu-item" onclick="setTheme('kawaii')">
                    <span>Kawaii</span>
                </button>
            </div>
        </div>
    </div>
    <div id="toolbar">
        <div class="toolbar-group">
            <div class="color-picker-wrapper">
                <div class="toolbar-button color-picker-button" onclick="toggleColorPicker(event)" title="Text Color">
                    <div class="color-preview" id="currentColor"></div>
                </div>
                <div class="color-picker-popup" id="colorPickerPopup">
                    <div class="preset-colors">
                        <div class="preset-color" style="background: #000000" onclick="setTextColor('#000000')"></div>
                        <div class="preset-color" style="background: #434343" onclick="setTextColor('#434343')"></div>
                        <div class="preset-color" style="background: #666666" onclick="setTextColor('#666666')"></div>
                        <div class="preset-color" style="background: #999999" onclick="setTextColor('#999999')"></div>
                        <div class="preset-color" style="background: #b7b7b7" onclick="setTextColor('#b7b7b7')"></div>
                        <div class="preset-color" style="background: #cccccc" onclick="setTextColor('#cccccc')"></div>
                        <div class="preset-color" style="background: #d9d9d9" onclick="setTextColor('#d9d9d9')"></div>
                        <div class="preset-color" style="background: #ffffff" onclick="setTextColor('#ffffff')"></div>
                        <div class="preset-color" style="background: #980000" onclick="setTextColor('#980000')"></div>
                        <div class="preset-color" style="background: #ff0000" onclick="setTextColor('#ff0000')"></div>
                        <div class="preset-color" style="background: #ff9900" onclick="setTextColor('#ff9900')"></div>
                        <div class="preset-color" style="background: #ffff00" onclick="setTextColor('#ffff00')"></div>
                        <div class="preset-color" style="background: #00ff00" onclick="setTextColor('#00ff00')"></div>
                        <div class="preset-color" style="background: #00ffff" onclick="setTextColor('#00ffff')"></div>
                        <div class="preset-color" style="background: #4a86e8" onclick="setTextColor('#4a86e8')"></div>
                        <div class="preset-color" style="background: #0000ff" onclick="setTextColor('#0000ff')"></div>
                        <div class="preset-color" style="background: #9900ff" onclick="setTextColor('#9900ff')"></div>
                        <div class="preset-color" style="background: #ff00ff" onclick="setTextColor('#ff00ff')"></div>
                        <div class="preset-color" style="background: #e6b8af" onclick="setTextColor('#e6b8af')"></div>
                        <div class="preset-color" style="background: #f4cccc" onclick="setTextColor('#f4cccc')"></div>
                        <div class="preset-color" style="background: #fce5cd" onclick="setTextColor('#fce5cd')"></div>
                        <div class="preset-color" style="background: #fff2cc" onclick="setTextColor('#fff2cc')"></div>
                        <div class="preset-color" style="background: #d9ead3" onclick="setTextColor('#d9ead3')"></div>
                        <div class="preset-color" style="background: #d0e0e3" onclick="setTextColor('#d0e0e3')"></div>
                    </div>
                    <div class="color-picker-divider"></div>
                    <div class="custom-color">
                        <input type="color" id="customColorPicker" onchange="setTextColor(this.value)" value="#000000">
                    </div>
                </div>
            </div>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-button" onclick="formatDoc('bold')" title="Bold"></button>
            <button class="toolbar-button" onclick="formatDoc('italic')" title="Italic"></button>
            <button class="toolbar-button" onclick="formatDoc('underline')" title="Underline"></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <select class="toolbar-button" onchange="formatDoc('fontSize', this.value)" title="Font Size">
                <option value="3">Normal</option>
                <option value="5">Sub-title</option>
                <option value="7">Title</option>
            </select>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-button" onclick="formatDoc('justifyLeft')" title="Align Left"></button>
            <button class="toolbar-button" onclick="formatDoc('justifyCenter')" title="Center"></button>
            <button class="toolbar-button" onclick="formatDoc('justifyRight')" title="Align Right"></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <div class="view-mode-switch" onclick="toggleViewMode()">
                <span class="doc-label">docx</span>
                <span class="spreadsheet-label">xlsx</span>
            </div>
        </div>
        <div class="toolbar-separator zoom-controls"><!-- Only show for spreadsheet mode --></div>
        <div class="toolbar-group zoom-controls"><!-- Only show for spreadsheet mode -->
            <button class="toolbar-button" onclick="adjustZoom(-10)" title="Zoom Out">-</button>
            <input type="range" min="50" max="200" value="100" class="zoom-slider" oninput="updateZoom(this.value)" title="Zoom Level">
            <button class="toolbar-button" onclick="adjustZoom(10)" title="Zoom In">+</button>
            <span class="zoom-level">100%</span>
        </div>
    </div>
    <div id="editor">
        <div class="editor-content" contenteditable="true"></div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const mammoth = require('mammoth');
        const XLSX = require('xlsx');

        function formatDoc(command, value = null) {
            document.execCommand(command, false, value);
        }

        function toggleFileMenu() {
            document.getElementById("fileMenu").classList.toggle("show");
            document.getElementById("styleMenu").classList.remove("show");
        }

        function toggleStyleMenu() {
            document.getElementById("styleMenu").classList.toggle("show");
            document.getElementById("fileMenu").classList.remove("show");
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            document.getElementById("styleMenu").classList.remove("show");
        }

        // Initialize theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        function newDocument() {
            if (confirm('Are you sure you want to create a new document? Any unsaved changes will be lost.')) {
                const editorContent = document.querySelector('.editor-content');
                window.currentWorkbook = null;
                window.currentHtmlContent = null;
                editorContent.innerHTML = '';
                editorContent.classList.remove('spreadsheet-view');
                document.querySelector('.view-mode-switch').classList.remove('spreadsheet-mode');
                editorContent.focus();
            }
        }

        function openFile() {
            ipcRenderer.send('open-file-dialog');
        }

        // Close dropdowns when clicking outside
        window.onclick = function(event) {
            if (!event.target.closest('.file-tab')) {
                const menus = document.getElementsByClassName("dropdown-menu");
                for (const menu of menus) {
                    if (menu.classList.contains('show')) {
                        menu.classList.remove('show');
                    }
                }
            }
        }

        function parseContentForDocx(content) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;

            function convertNodeToDocx(node) {
                const result = {
                    type: 'text',
                    text: '',
                    bold: false,
                    italic: false,
                    underline: false,
                    children: []
                };
                
                // Process text nodes
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent.trim();
                    if (text) {
                        result.text = text;
                    }
                    return result;
                }

                // Process element nodes
                if (node.nodeType === Node.ELEMENT_NODE) {
                    const style = window.getComputedStyle(node);
                    
                    // Apply formatting based on HTML elements and styles
                    if (node.tagName === 'B' || node.tagName === 'STRONG' || style.fontWeight === 'bold') {
                        result.bold = true;
                    }
                    if (node.tagName === 'I' || node.tagName === 'EM' || style.fontStyle === 'italic') {
                        result.italic = true;
                    }
                    if (node.tagName === 'U' || style.textDecoration === 'underline') {
                        result.underline = true;
                    }

                    // Process child nodes
                    Array.from(node.childNodes).forEach(childNode => {
                        const childResult = convertNodeToDocx(childNode);
                        if (childResult.text || childResult.children.length > 0) {
                            result.children.push(childResult);
                        }
                    });

                    // Handle block elements
                    if (['P', 'DIV', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(node.tagName)) {
                        return {
                            type: 'paragraph',
                            children: result.children
                        };
                    }

                    return result;
                }

                return result;
            }

            return convertNodeToDocx(tempDiv);
        }

        function saveDocument(format) {
            const editorContent = document.querySelector('.editor-content');
            const isSpreadsheetMode = document.querySelector('.view-mode-switch').classList.contains('spreadsheet-mode');
            
            // Show loading overlay for PDF generation
            if (format === 'pdf') {
                document.querySelector('.loading-overlay').classList.add('show');
            }
            
            if (isSpreadsheetMode) {
                // Get the table data from the current view
                const table = editorContent.querySelector('.spreadsheet-table');
                if (!table) {
                    alert('No spreadsheet data to save');
                    return;
                }
                
                // Convert table to worksheet data
                const data = [];
                const rows = table.querySelectorAll('tr');
                
                // Skip the first row (header row) and process the rest
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    const rowData = [];
                    const cells = row.querySelectorAll('td');
                    
                    // Skip the first cell (row number) and process the rest
                    for (let j = 1; j < cells.length; j++) {
                        const cell = cells[j];
                        // Only add the cell content if it's not a header cell
                        if (!cell.classList.contains('column-header')) {
                            rowData.push(cell.textContent);
                        }
                    }
                    
                    // Only add the row if it has any data
                    if (rowData.some(cell => cell.trim() !== '')) {
                        data.push(rowData);
                    }
                }

                if (format === 'xlsx') {
                    // Send the data to main process for XLSX
                    ipcRenderer.send('save-file', { 
                        content: data, 
                        format: 'xlsx'
                    });
                } else if (format === 'pdf' || format === 'html') {
                    // Create a clean table without headers for PDF/HTML export
                    const cleanTable = document.createElement('table');
                    cleanTable.className = 'spreadsheet-table';
                    
                    // Add data rows
                    data.forEach(rowData => {
                        const tr = document.createElement('tr');
                        rowData.forEach(cellData => {
                            const td = document.createElement('td');
                            td.textContent = cellData;
                            tr.appendChild(td);
                        });
                        cleanTable.appendChild(tr);
                    });

                    // Create a temporary container for the clean table
                    const tempContainer = document.createElement('div');
                    tempContainer.appendChild(cleanTable);
                    
                    // Send the clean HTML to main process
                    ipcRenderer.send('save-file', { 
                        content: tempContainer.innerHTML, 
                        format 
                    });
                }
            } else {
                // Handle document mode (DOCX, PDF, HTML)
                if (format === 'docx') {
                    const parsedContent = parseContentForDocx(editorContent.innerHTML);
                    ipcRenderer.send('save-file', { content: parsedContent, format });
                } else {
                    ipcRenderer.send('save-file', { content: editorContent.innerHTML, format });
                }
            }
        }

        function isSpreadsheet(filePath) {
            return filePath.toLowerCase().endsWith('.xlsx') || filePath.toLowerCase().endsWith('.xls');
        }

        function renderSpreadsheet(workbook) {
            let firstSheet;
            let range;
            
            if (workbook) {
                firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                range = XLSX.utils.decode_range(firstSheet['!ref'] || 'A1:Z100');
            } else {
                // Default range for empty spreadsheet - show at least 100 rows and 26 columns (A-Z)
                range = {
                    s: { r: 0, c: 0 },
                    e: { r: 99, c: 25 } // A1:Z100
                };
            }
            
            const maxCol = range.e.c;
            let actualMaxRow = range.e.r;
            
            // If we have data, find the actual last row with content
            if (firstSheet) {
                actualMaxRow = 0;
                for (let r = range.s.r; r <= range.e.r; r++) {
                    let rowHasContent = false;
                    for (let c = 0; c <= maxCol; c++) {
                        const cellRef = XLSX.utils.encode_cell({r: r, c: c});
                        if (firstSheet[cellRef]) {
                            rowHasContent = true;
                            break;
                        }
                    }
                    if (rowHasContent) {
                        actualMaxRow = r;
                    }
                }
                // Always show at least 100 rows or the content, whichever is greater
                actualMaxRow = Math.max(actualMaxRow, 99);
            }
            
            // Create a wrapper div for the spreadsheet
            const wrapper = document.createElement('div');
            wrapper.className = 'spreadsheet-wrapper';
            
            const container = document.createElement('div');
            container.className = 'spreadsheet-container';
            
            const table = document.createElement('table');
            table.className = 'spreadsheet-table';
            
            // Handle merged cells
            const merges = firstSheet ? (firstSheet['!merges'] || []) : [];
            const mergedCells = new Map();
            merges.forEach(merge => {
                for (let r = merge.s.r; r <= merge.e.r; r++) {
                    for (let c = merge.s.c; c <= merge.e.c; c++) {
                        const cellRef = XLSX.utils.encode_cell({r, c});
                        mergedCells.set(cellRef, {
                            master: XLSX.utils.encode_cell({r: merge.s.r, c: merge.s.c}),
                            rowspan: merge.e.r - merge.s.r + 1,
                            colspan: merge.e.c - merge.s.c + 1
                        });
                    }
                }
            });
            
            // Create column header row
            const colHeaderRow = document.createElement('tr');
            colHeaderRow.innerHTML = '<th class="corner-cell"></th>'; // Empty corner cell
            
            // Add column headers (A, B, C, etc.)
            for (let i = 0; i <= maxCol; i++) {
                const th = document.createElement('th');
                th.textContent = XLSX.utils.encode_col(i);
                th.className = 'column-header';
                colHeaderRow.appendChild(th);
            }
            table.appendChild(colHeaderRow);
            
            // Create data rows
            for (let r = range.s.r; r <= actualMaxRow; r++) {
                const row = document.createElement('tr');
                
                // Add row number
                const rowHeader = document.createElement('td');
                rowHeader.className = 'row-header';
                rowHeader.textContent = (r + 1).toString();
                row.appendChild(rowHeader);
                
                // Add cells
                for (let c = 0; c <= maxCol; c++) {
                    const cellRef = XLSX.utils.encode_cell({r, c});
                    const mergeInfo = mergedCells.get(cellRef);
                    
                    // Skip if this cell is part of a merge (except the master cell)
                    if (mergeInfo && cellRef !== mergeInfo.master) {
                        continue;
                    }
                    
                    const cell = document.createElement('td');
                    cell.className = 'spreadsheet-cell';
                    
                    // Apply merge attributes if this is a master cell
                    if (mergeInfo) {
                        cell.rowSpan = mergeInfo.rowspan;
                        cell.colSpan = mergeInfo.colspan;
                    }
                    
                    if (firstSheet) {
                        const cellData = firstSheet[cellRef];
                        
                        if (cellData) {
                            // Apply cell value with proper formatting
                            if (cellData.w !== undefined) {
                                cell.textContent = cellData.w;
                            } else if (cellData.v !== undefined) {
                                cell.textContent = cellData.v;
                            }
                            
                            // Apply styles if present
                            if (cellData.s) {
                                let style = {};
                                // Parse the style if it's a string (from our debug output)
                                if (typeof cellData.s === 'string') {
                                    try {
                                        style = JSON.parse(cellData.s);
                                    } catch (e) {
                                        console.error('Error parsing style:', e);
                                    }
                                } else {
                                    style = cellData.s;
                                }
                                
                                // Handle background/fill
                                if (style.patternType === 'solid') {
                                    // Handle foreground color
                                    if (style.fgColor) {
                                        if (style.fgColor.rgb) {
                                            cell.style.backgroundColor = `#${style.fgColor.rgb}`;
                                            // If background is dark, make text white by default unless specified
                                            const rgb = parseInt(style.fgColor.rgb, 16);
                                            const r = (rgb >> 16) & 0xff;
                                            const g = (rgb >> 8) & 0xff;
                                            const b = rgb & 0xff;
                                            // Calculate luminance - if dark background, use white text by default
                                            if ((r * 0.299 + g * 0.587 + b * 0.114) < 128) {
                                                cell.style.color = '#FFFFFF';
                                            }
                                        } else if (style.fgColor.theme !== undefined) {
                                            const themeColor = processExcelColor(style.fgColor);
                                            if (themeColor) {
                                                cell.style.backgroundColor = themeColor;
                                            }
                                        }
                                    }
                                    // If no fgColor but bgColor exists, use bgColor
                                    else if (style.bgColor && style.bgColor.rgb) {
                                        cell.style.backgroundColor = `#${style.bgColor.rgb}`;
                                    }
                                }
                                
                                // Handle font styles - moved after background to override default color if specified
                                if (style.font) {
                                    if (style.font.bold) cell.style.fontWeight = 'bold';
                                    if (style.font.italic) cell.style.fontStyle = 'italic';
                                    if (style.font.underline) cell.style.textDecoration = 'underline';
                                    if (style.font.name) cell.style.fontFamily = style.font.name;
                                    if (style.font.sz) cell.style.fontSize = `${style.font.sz}pt`;
                                    // Handle font color - this will override the default white text on dark background if specified
                                    if (style.font.color) {
                                        if (style.font.color.rgb) {
                                            cell.style.color = `#${style.font.color.rgb}`;
                                        } else if (style.font.color.theme !== undefined) {
                                            const themeColor = processExcelColor(style.font.color);
                                            if (themeColor) {
                                                cell.style.color = themeColor;
                                            }
                                        } else if (style.font.color.indexed !== undefined) {
                                            const indexedColor = processExcelColor(style.font.color);
                                            if (indexedColor) {
                                                cell.style.color = indexedColor;
                                            }
                                        }
                                    }
                                }
                                
                                // Handle alignment
                                if (style.alignment) {
                                    if (style.alignment.horizontal) cell.style.textAlign = style.alignment.horizontal;
                                    if (style.alignment.vertical) cell.style.verticalAlign = style.alignment.vertical;
                                    if (style.alignment.wrapText) {
                                        cell.style.whiteSpace = 'normal';
                                        cell.style.wordBreak = 'break-word';
                                    }
                                }
                                
                                // Handle borders
                                if (style.border) {
                                    ['top', 'right', 'bottom', 'left'].forEach(side => {
                                        if (style.border[side] && style.border[side].style) {
                                            const width = style.border[side].style === 'thick' ? '3px' :
                                                        style.border[side].style === 'medium' ? '2px' : '1px';
                                            const color = style.border[side].color ? 
                                                processExcelColor(style.border[side].color) : '#000000';
                                            cell.style[`border${side.charAt(0).toUpperCase() + side.slice(1)}`] = 
                                                `${width} solid ${color}`;
                                        }
                                    });
                                }
                            }
                        }
                    }
                    
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            container.appendChild(table);
            wrapper.appendChild(container);
            
            // Add the wrapper to the editor
            document.querySelector('.editor-content').innerHTML = '';
            document.querySelector('.editor-content').appendChild(wrapper);
            
            // Apply zoom if it's not 100%
            if (currentZoom !== 100) {
                applyZoom();
            }
        }

        let currentZoom = 100;
        
        function updateZoom(value) {
            currentZoom = parseInt(value);
            applyZoom();
            document.querySelector('.zoom-level').textContent = `${currentZoom}%`;
        }
        
        function adjustZoom(delta) {
            const slider = document.querySelector('.zoom-slider');
            const newValue = Math.min(Math.max(parseInt(slider.value) + delta, 50), 200);
            slider.value = newValue;
            updateZoom(newValue);
        }
        
        function applyZoom() {
            const container = document.querySelector('.spreadsheet-container');
            if (container) {
                container.style.transform = `scale(${currentZoom / 100})`;
                // No need to adjust wrapper dimensions anymore
            }
        }
        
        function toggleViewMode() {
            const editorContent = document.querySelector('.editor-content');
            const viewSwitch = document.querySelector('.view-mode-switch');
            const isSpreadsheetMode = !viewSwitch.classList.contains('spreadsheet-mode');
            
            viewSwitch.classList.toggle('spreadsheet-mode');
            document.getElementById('toolbar').classList.toggle('spreadsheet-mode', isSpreadsheetMode);
            
            if (isSpreadsheetMode) {
                editorContent.classList.add('spreadsheet-view');
                renderSpreadsheet(window.currentWorkbook);
                // Reset zoom when switching to spreadsheet mode
                currentZoom = 100;
                document.querySelector('.zoom-slider').value = 100;
                document.querySelector('.zoom-level').textContent = '100%';
            } else {
                editorContent.classList.remove('spreadsheet-view');
                if (window.currentHtmlContent) {
                    editorContent.innerHTML = window.currentHtmlContent;
                } else {
                    editorContent.innerHTML = '';
                }
            }
            
            updateSaveMenuText();
        }

        ipcRenderer.on('file-opened', async (event, filePath) => {
            try {
                // Clear any previous stored content
                window.currentWorkbook = null;
                window.currentHtmlContent = null;
                
                // Clear any previous view classes
                const editorContent = document.querySelector('.editor-content');
                const viewSwitch = document.querySelector('.view-mode-switch');
                
                if (isSpreadsheet(filePath)) {
                    // Load with full style options
                    const workbook = XLSX.readFile(filePath, { 
                        cellStyles: true,
                        cellNF: true,
                        cellDates: true,
                        cellText: false
                    });
                    
                    // Enhanced debugging
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    console.log('Sheet Name:', workbook.SheetNames[0]);
                    console.log('Sheet Properties:', Object.keys(firstSheet).filter(k => k.startsWith('!')));
                    
                    // Log all cells with their styles
                    Object.entries(firstSheet).forEach(([key, value]) => {
                        if (!key.startsWith('!')) {
                            console.log(`Cell ${key}:`, {
                                value: value.v,
                                style: value.s ? JSON.stringify(value.s, null, 2) : 'no style',
                                format: value.z
                            });
                        }
                    });
                    
                    window.currentWorkbook = workbook;
                    viewSwitch.classList.add('spreadsheet-mode');
                    editorContent.classList.add('spreadsheet-view');
                    renderSpreadsheet(workbook);
                } else {
                    editorContent.classList.remove('spreadsheet-view');
                    viewSwitch.classList.remove('spreadsheet-mode');
                    const result = await mammoth.convertToHtml({ path: filePath });
                    editorContent.innerHTML = result.value;
                    window.currentHtmlContent = result.value;
                }
            } catch (error) {
                console.error('Error opening file:', error);
                alert('Error opening file: ' + error.message);
            }
        });

        ipcRenderer.on('save-complete', (event, success) => {
            // Hide loading overlay
            document.querySelector('.loading-overlay').classList.remove('show');
            
            // Only show alerts for actual save attempts (success will be true or false)
            // We don't show anything for cancellation (when success is null)
            if (success === true) {
                alert('File saved successfully!');
            } else if (success === false) {
                alert('Error saving file. Please try again.');
            }
        });

        // Add this after the other ipcRenderer.on handlers
        ipcRenderer.on('trigger-shortcut', (event, action) => {
            switch (action) {
                case 'save':
                    // Check if we're in spreadsheet mode
                    const isSpreadsheetMode = document.querySelector('.view-mode-switch').classList.contains('spreadsheet-mode');
                    // Save with the appropriate format based on the current view mode
                    saveDocument(isSpreadsheetMode ? 'xlsx' : 'docx');
                    break;
                case 'new':
                    newDocument();
                    break;
                case 'open':
                    openFile();
                    break;
            }
        });

        // Update the menu items to show the dynamic shortcut text
        function updateSaveMenuText() {
            const isSpreadsheetMode = document.querySelector('.view-mode-switch').classList.contains('spreadsheet-mode');
            const format = isSpreadsheetMode ? 'XLSX' : 'DOCX';
            document.querySelector('.menu-item[onclick="saveDocument(\'docx\')"] span').textContent = `Save as ${format} (⌘S)`;
        }

        // Call updateSaveMenuText when initializing
        document.addEventListener('DOMContentLoaded', () => {
            updateSaveMenuText();
            // Initialize editor
            document.querySelector('.editor-content').focus();
        });

        // Add this helper function for color processing
        function processExcelColor(color) {
            if (!color) return null;
            
            // Handle RGB colors
            if (color.rgb) {
                let rgb = color.rgb;
                // Handle both RGB and ARGB formats
                if (rgb.length === 8) rgb = rgb.substring(2);
                return `#${rgb}`;
            }
            
            // Handle theme colors
            if (color.theme !== undefined) {
                const themeColors = {
                    0: '#FFFFFF', // Background 1
                    1: '#000000', // Text 1
                    2: '#1F497D', // Background 2
                    3: '#EEECE1', // Text 2
                    4: '#4F81BD', // Accent 1
                    5: '#C0504D', // Accent 2
                    6: '#9BBB59', // Accent 3
                    7: '#8064A2', // Accent 4
                    8: '#4BACC6', // Accent 5
                    9: '#F79646'  // Accent 6
                };
                
                let themeColor = themeColors[color.theme] || '#000000';
                
                // Apply tint if present
                if (color.tint) {
                    // Convert hex to RGB
                    let r = parseInt(themeColor.slice(1,3), 16);
                    let g = parseInt(themeColor.slice(3,5), 16);
                    let b = parseInt(themeColor.slice(5,7), 16);
                    
                    if (color.tint < 0) {
                        // Darken
                        r = Math.round(r * (1 + color.tint));
                        g = Math.round(g * (1 + color.tint));
                        b = Math.round(b * (1 + color.tint));
                    } else {
                        // Lighten
                        r = Math.round(r + (255 - r) * color.tint);
                        g = Math.round(g + (255 - g) * color.tint);
                        b = Math.round(b + (255 - b) * color.tint);
                    }
                    
                    themeColor = `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;
                }
                
                return themeColor;
            }
            
            // Handle indexed colors
            if (color.indexed !== undefined) {
                const indexedColors = [
                    '#000000', '#FFFFFF', '#FF0000', '#00FF00', '#0000FF',
                    '#FFFF00', '#FF00FF', '#00FFFF', '#800000', '#008000',
                    '#000080', '#808000', '#800080', '#008080', '#C0C0C0',
                    '#808080', '#9999FF', '#993366', '#FFFFCC', '#CCFFFF'
                ];
                return indexedColors[color.indexed] || '#000000';
            }
            
            return null;
        }

        // Add keyboard shortcuts for zooming
        document.addEventListener('keydown', (e) => {
            if (e.metaKey || e.ctrlKey) {  // Command/Control key
                if (e.key === '=' || e.key === '+') {  // Zoom in
                    e.preventDefault();
                    adjustZoom(10);
                } else if (e.key === '-') {  // Zoom out
                    e.preventDefault();
                    adjustZoom(-10);
                } else if (e.key === '0') {  // Reset zoom
                    e.preventDefault();
                    updateZoom(100);
                }
            }
        });

        // Add these functions to your existing script section
        function toggleColorPicker(event) {
            event.stopPropagation();
            const popup = document.getElementById('colorPickerPopup');
            popup.classList.toggle('show');
        }

        function setTextColor(color) {
            // Update the color preview and color picker
            document.getElementById('currentColor').style.backgroundColor = color;
            document.getElementById('customColorPicker').value = color;
            
            // Apply the color to selected text or set it as the current color
            document.execCommand('foreColor', false, color);
            
            // Store the current color for new text
            document.querySelector('.editor-content').style.color = color;
            
            // Don't hide the popup when using the color wheel
            if (!event.target.matches('#customColorPicker')) {
                document.getElementById('colorPickerPopup').classList.remove('show');
            }
        }

        // Add this to ensure new text uses the selected color
        document.querySelector('.editor-content').addEventListener('focus', function() {
            const currentColor = document.getElementById('currentColor').style.backgroundColor;
            if (currentColor) {
                this.style.color = currentColor;
            }
        });

        // Close color picker when clicking outside
        document.addEventListener('click', function(event) {
            const popup = document.getElementById('colorPickerPopup');
            const colorPicker = document.querySelector('.color-picker-wrapper');
            if (!colorPicker.contains(event.target)) {
                popup.classList.remove('show');
            }
        });

        // Initialize the current color preview
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentColor').style.backgroundColor = '#000000';
        });
    </script>
</body>
</html> 